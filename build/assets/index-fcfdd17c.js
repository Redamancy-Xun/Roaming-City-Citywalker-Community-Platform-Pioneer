import{c as G,v as j,h as ge,i as fe,n as Z,t as z,a as N,w as te,M as he,N as we,u as ie,f as M,z as A,O as R,P as ye,F as ne,L as Pe,m as Se,k as _,q as ee,D as Ie,E as be,p as Ce,H as xe,j as ze}from"./use-touch-78a9110c.js";import{I as le,P as ke}from"./index-965c857b.js";import{S as Oe,a as Te}from"./index-0421c015.js";import{d as V,i as k,N as Le,q as B,s as Y,H as Re,o as se,n as F,e as c,D as Ye,O as Ee,G as U,C as re}from"./index-c336339f.js";import{L as Xe}from"./index-d6d9cd4a.js";const[$e,X]=G("image"),Ze={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:Z,height:Z,radius:Z,lazyLoad:Boolean,iconSize:Z,showError:z,errorIcon:N("photo-fail"),iconPrefix:String,showLoading:z,loadingIcon:N("photo"),crossorigin:String,referrerpolicy:String};var De=V({name:$e,props:Ze,emits:["load","error"],setup(e,{emit:m,slots:v}){const o=k(!1),r=k(!0),l=k(),{$Lazyload:d}=Le().proxy,O=B(()=>{const t={width:j(e.width),height:j(e.height)};return ge(e.radius)&&(t.overflow="hidden",t.borderRadius=j(e.radius)),t});Y(()=>e.src,()=>{o.value=!1,r.value=!0});const g=t=>{r.value&&(r.value=!1,m("load",t))},b=()=>{const t=new Event("load");Object.defineProperty(t,"target",{value:l.value,enumerable:!0}),g(t)},T=t=>{o.value=!0,r.value=!1,m("error",t)},f=(t,w,I)=>I?I():c(le,{name:t,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),h=()=>{if(r.value&&e.showLoading)return c("div",{class:X("loading")},[f(e.loadingIcon,X("loading-icon"),v.loading)]);if(o.value&&e.showError)return c("div",{class:X("error")},[f(e.errorIcon,X("error-icon"),v.error)])},L=()=>{if(o.value||!e.src)return;const t={alt:e.alt,class:X("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?Ye(c("img",U({ref:l},t),null),[[Ee("lazy"),e.src]]):c("img",U({ref:l,src:e.src,onLoad:g,onError:T},t),null)},S=({el:t})=>{const w=()=>{t===l.value&&r.value&&b()};l.value?w():F(w)},E=({el:t})=>{t===l.value&&!o.value&&T()};return d&&fe&&(d.$on("loaded",S),d.$on("error",E),Re(()=>{d.$off("loaded",S),d.$off("error",E)})),se(()=>{F(()=>{var t;(t=l.value)!=null&&t.complete&&!e.lazyLoad&&b()})}),()=>{var t;return c("div",{class:X({round:e.round,block:e.block}),style:O.value},[L(),h(),(t=v.default)==null?void 0:t.call(v)])}}});const Be=te(De),oe=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),He=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),q=G("image-preview")[1],ae=2.6,Me={src:String,show:Boolean,active:Number,minZoom:M(Z),maxZoom:M(Z),rootWidth:M(Number),rootHeight:M(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var _e=V({props:Me,emits:["scale","close","longPress"],setup(e,{emit:m,slots:v}){const o=re({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=he(),l=k(),d=k(),O=k(!1),g=k(!1);let b=0;const T=B(()=>{const{scale:a,moveX:i,moveY:n,moving:u,zooming:P,initializing:x}=o,H={transitionDuration:P||u||x?"0s":".3s"};return(a!==1||g.value)&&(H.transform=`matrix(${a}, 0, 0, ${a}, ${i}, ${n})`),H}),f=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=O.value?i/o.imageRatio:a;return Math.max(0,(o.scale*n-a)/2)}return 0}),h=B(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:i}=e,n=O.value?i:a*o.imageRatio;return Math.max(0,(o.scale*n-i)/2)}return 0}),L=(a,i)=>{var n;if(a=R(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const u=a/o.scale;if(o.scale=a,i){const P=ne((n=l.value)==null?void 0:n.$el),x={x:P.width*.5,y:P.height*.5},H=o.moveX-(i.x-P.left-x.x)*(u-1),de=o.moveY-(i.y-P.top-x.y)*(u-1);o.moveX=R(H,-f.value,f.value),o.moveY=R(de,-h.value,h.value)}else o.moveX=0,o.moveY=g.value?b:0;m("scale",{scale:a,index:e.active})}},S=()=>{L(1)},E=()=>{const a=o.scale>1?1:2;L(a,a===2||g.value?{x:r.startX.value,y:r.startY.value}:void 0)};let t,w,I,s,C,y,D,K,W=!1;const ce=a=>{const{touches:i}=a;if(t=i.length,t===2&&e.disableZoom)return;const{offsetX:n}=r;r.start(a),w=o.moveX,I=o.moveY,K=Date.now(),W=!1,o.moving=t===1&&(o.scale!==1||g.value),o.zooming=t===2&&!n.value,o.zooming&&(s=o.scale,C=oe(i))},ue=a=>{const{touches:i}=a;if(r.move(a),o.moving){const{deltaX:n,deltaY:u}=r,P=n.value+w,x=u.value+I;if((e.vertical?r.isVertical()&&Math.abs(x)>h.value:r.isHorizontal()&&Math.abs(P)>f.value)&&!W){o.moving=!1;return}W=!0,A(a,!0),o.moveX=R(P,-f.value,f.value),o.moveY=R(x,-h.value,h.value)}if(o.zooming&&(A(a,!0),i.length===2)){const n=oe(i),u=s*n/C;y=He(i),L(u,y)}},J=a=>{var i;const n=(i=d.value)==null?void 0:i.$el,u=n.firstElementChild,P=a.target===n,x=u==null?void 0:u.contains(a.target);!e.closeOnClickImage&&x||!e.closeOnClickOverlay&&P||m("close")},me=a=>{if(t>1)return;const i=Date.now()-K,n=250;r.isTap.value&&(i<n?e.doubleScale?D?(clearTimeout(D),D=null,E()):D=setTimeout(()=>{J(a),D=null},n):J(a):i>Pe&&m("longPress"))},Q=a=>{let i=!1;if((o.moving||o.zooming)&&(i=!0,o.moving&&w===o.moveX&&I===o.moveY&&(i=!1),!a.touches.length)){o.zooming&&(o.moveX=R(o.moveX,-f.value,f.value),o.moveY=R(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,w=0,I=0,s=1,o.scale<1&&S();const n=+e.maxZoom;o.scale>n&&L(n,y)}A(a,i),me(a),r.reset()},p=()=>{const{rootWidth:a,rootHeight:i}=e,n=i/a,{imageRatio:u}=o;O.value=o.imageRatio>n&&u<ae,g.value=o.imageRatio>n&&u>=ae,g.value&&(b=(u*a-i)/2,o.moveY=b,o.initializing=!0,ye(()=>{o.initializing=!1})),S()},ve=a=>{const{naturalWidth:i,naturalHeight:n}=a.target;o.imageRatio=n/i,p()};return Y(()=>e.active,S),Y(()=>e.show,a=>{a||S()}),Y(()=>[e.rootWidth,e.rootHeight],p),we("touchmove",ue,{target:B(()=>{var a;return(a=d.value)==null?void 0:a.$el})}),ie({resetScale:S}),()=>{const a={loading:()=>c(Xe,{type:"spinner"},null)};return c(Oe,{ref:d,class:q("swipe-item"),onTouchstartPassive:ce,onTouchend:Q,onTouchcancel:Q},{default:()=>[v.image?c("div",{class:q("image-wrap")},[v.image({src:e.src})]):c(Be,{ref:l,src:e.src,fit:"contain",class:q("image",{vertical:O.value}),style:T.value,onLoad:ve},a)]})}}});const[Ne,$]=G("image-preview"),We=["show","teleport","transition","overlayStyle","closeOnPopstate"],je={show:Boolean,loop:z,images:Se(),minZoom:_(1/3),maxZoom:_(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:ee,closeIcon:N("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:ee,overlayStyle:Object,swipeDuration:_(300),startPosition:_(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:N("top-right"),teleport:[String,Object]};var Ae=V({name:Ne,props:je,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:m,slots:v}){const o=k(),r=k(),l=re({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),d=()=>{if(o.value){const s=ne(o.value.$el);l.rootWidth=s.width,l.rootHeight=s.height,o.value.resize()}},O=s=>m("scale",s),g=s=>m("update:show",s),b=()=>{ze(e.beforeClose,{args:[l.active],done:()=>g(!1)})},T=s=>{s!==l.active&&(l.active=s,m("change",s))},f=()=>{if(e.showIndex)return c("div",{class:$("index")},[v.index?v.index({index:l.active}):`${l.active+1} / ${e.images.length}`])},h=()=>{if(v.cover)return c("div",{class:$("cover")},[v.cover()])},L=()=>{l.disableZoom=!0},S=()=>{l.disableZoom=!1},E=()=>c(Te,{ref:o,lazyRender:!0,loop:e.loop,class:$("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:T,onDragEnd:S,onDragStart:L},{default:()=>[e.images.map((s,C)=>c(_e,{ref:y=>{C===l.active&&(r.value=y)},src:s,show:e.show,active:l.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:l.rootWidth,rootHeight:l.rootHeight,disableZoom:l.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:O,onClose:b,onLongPress:()=>m("longPress",{index:C})},{image:v.image}))]}),t=()=>{if(e.closeable)return c(le,{role:"button",name:e.closeIcon,class:[$("close-icon",e.closeIconPosition),xe],onClick:b},null)},w=()=>m("closed"),I=(s,C)=>{var y;return(y=o.value)==null?void 0:y.swipeTo(s,C)};return ie({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:I}),se(d),Y([Ie,be],d),Y(()=>e.startPosition,s=>T(+s)),Y(()=>e.show,s=>{const{images:C,startPosition:y}=e;s?(T(+y),F(()=>{d(),I(+y,{immediate:!0})})):m("close",{index:l.active,url:C[l.active]})}),()=>c(ke,U({class:[$(),e.className],overlayClass:[$("overlay"),e.overlayClass],onClosed:w,"onUpdate:show":g},Ce(e,We)),{default:()=>[t(),E(),f(),h()]})}});const Ke=te(Ae);export{Ke as I,Be as a,Ae as s};
