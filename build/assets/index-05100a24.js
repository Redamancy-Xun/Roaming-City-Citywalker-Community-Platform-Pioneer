import{N as p,D as q,A as T,i as k,d as L,e as d,T as _,v as R,E as N,m as X,z as ee,o as oe,O as te,P as ne,Q as ae,F as se,B as A}from"./index-7421df47.js";import{n as C,t as m,i as K,O as le,P as ce,p as $,c as j,J as F,e as H,Q as re,z as M,w as G,m as z,r as ie,H as ue}from"./index-dcd1bf9c.js";import{a as de,u as fe,P as ve}from"./use-touch-fbe6bb65.js";import{u as B,I as me}from"./use-scope-id-02176d93.js";let ye=2e3;const he=()=>++ye,U={show:Boolean,zIndex:C,overlay:m,duration:C,teleport:[String,Object],lockScroll:m,lazyRender:m,beforeClose:Function,overlayStyle:Object,overlayClass:K,transitionAppear:Boolean,closeOnClickOverlay:m},Be=Object.keys(U);let h=0;const E="van-overflow-hidden";function Ie(e,o){const n=de(),f="01",a="10",c=r=>{n.move(r);const v=n.deltaY.value>0?a:f,x=ce(r.target,e.value),{scrollHeight:y,offsetHeight:O,scrollTop:P}=x;let i="11";P===0?i=O>=y?"00":"01":P+O>=y&&(i="10"),i!=="11"&&n.isVertical()&&!(parseInt(i,2)&parseInt(v,2))&&$(r,!0)},s=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",c,{passive:!1}),h||document.body.classList.add(E),h++},l=()=>{h&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",c),h--,h||document.body.classList.remove(E))},S=()=>o()&&s(),I=()=>o()&&l();le(S),p(I),q(I),T(o,r=>{r?s():l()})}function Y(e){const o=k(!1);return T(e,n=>{n&&(o.value=n)},{immediate:!0}),n=>()=>o.value?n():null}const[Oe,Pe]=j("overlay"),we={show:Boolean,zIndex:C,duration:C,className:K,lockScroll:m,lazyRender:m,customStyle:Object};var ke=L({name:Oe,props:we,setup(e,{slots:o}){const n=k(),f=Y(()=>e.show||!e.lazyRender),a=s=>{e.lockScroll&&$(s,!0)},c=f(()=>{var s;const l=H(re(e.zIndex),e.customStyle);return M(e.duration)&&(l.animationDuration=`${e.duration}s`),R(d("div",{ref:n,style:l,class:[Pe(),e.className]},[(s=o.default)==null?void 0:s.call(o)]),[[N,e.show]])});return F("touchmove",a,{target:n}),()=>d(_,{name:"van-fade",appear:!0},{default:c})}});const Ce=G(ke),Se=H({},U,{round:Boolean,position:z("center"),closeIcon:z("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:z("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[xe,D]=j("popup");var be=L({name:xe,inheritAttrs:!1,props:Se,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:o,attrs:n,slots:f}){let a,c;const s=k(),l=k(),S=Y(()=>e.show||!e.lazyRender),I=X(()=>{const t={zIndex:s.value};if(M(e.duration)){const u=e.position==="center"?"animationDuration":"transitionDuration";t[u]=`${e.duration}s`}return t}),r=()=>{a||(a=!0,s.value=e.zIndex!==void 0?+e.zIndex:he(),o("open"))},v=()=>{a&&ie(e.beforeClose,{done(){a=!1,o("close"),o("update:show",!1)}})},x=t=>{o("clickOverlay",t),e.closeOnClickOverlay&&v()},y=()=>{if(e.overlay)return d(Ce,A({show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},B(),{onClick:x}),{default:f["overlay-content"]})},O=t=>{o("clickCloseIcon",t),v()},P=()=>{if(e.closeable)return d(me,{role:"button",tabindex:0,name:e.closeIcon,class:[D("close-icon",e.closeIconPosition),ue],classPrefix:e.iconPrefix,onClick:O},null)};let i;const Z=()=>{i&&clearTimeout(i),i=setTimeout(()=>{o("opened")})},Q=()=>o("closed"),V=t=>o("keydown",t),J=S(()=>{var t;const{round:u,position:w,safeAreaInsetTop:b,safeAreaInsetBottom:W}=e;return R(d("div",A({ref:l,style:I.value,role:"dialog",tabindex:0,class:[D({round:u,[w]:w}),{"van-safe-area-top":b,"van-safe-area-bottom":W}],onKeydown:V},n,B()),[(t=f.default)==null?void 0:t.call(f),P()]),[[N,e.show]])}),g=()=>{const{position:t,transition:u,transitionAppear:w}=e,b=t==="center"?"van-fade":`van-popup-slide-${t}`;return d(_,{name:u||b,appear:w,onAfterEnter:Z,onAfterLeave:Q},{default:J})};return T(()=>e.show,t=>{t&&!a&&(r(),n.tabindex===0&&ee(()=>{var u;(u=l.value)==null||u.focus()})),!t&&a&&(a=!1,o("close"))}),fe({popupRef:l}),Ie(l,()=>e.show&&e.lockScroll),F("popstate",()=>{e.closeOnPopstate&&(v(),c=!1)}),oe(()=>{e.show&&r()}),te(()=>{c&&(o("update:show",!0),c=!1)}),p(()=>{e.show&&e.teleport&&(v(),c=!0)}),ne(ve,()=>e.show),()=>e.teleport?d(ae,{to:e.teleport},{default:()=>[y(),g()]}):d(se,null,[y(),g()])}});const Ee=G(be);export{Ee as P,Be as a,U as p};
