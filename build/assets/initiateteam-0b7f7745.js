import{q as T,i as _,s as C,o as N,a as V,c as R,b as a,e as h,w as A,u as l,n as S,v as w,x as y,y as B,t as J,F as O,r as $,p as E,h as M}from"./index-7421df47.js";/* empty css              */import{a as W,U as q,A as z}from"./index-d662d2a4.js";/* empty css              */import{_ as j}from"./Back-64c2790a.js";import{_ as G}from"./footer.vue_vue_type_script_setup_true_lang-fbe79d79.js";import{A as H}from"./Citywalker-1838a2bc.js";import{u as K}from"./userStore-b1331fcf.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import{a as v}from"./function-call-eaca0cc0.js";import"./use-scope-id-02176d93.js";import"./index-dcd1bf9c.js";import"./index-05100a24.js";import"./use-touch-fbe6bb65.js";import"./index-1a41a3f5.js";import"./index-03c1dd54.js";import"./use-route-2e53a763.js";/* empty css                                                                   */const X=""+new URL("addorange-291c88a6.svg",import.meta.url).href,Y=""+new URL("savedraft_orange-a8476d02.svg",import.meta.url).href,Z=""+new URL("submitpost_orange-5428e2ba.svg",import.meta.url).href,tt=T({id:"post",state:()=>({title:"",introduction:"",images:[],fileList:[]}),actions:{clearPost(){this.title="",this.introduction="",this.images=[],this.fileList=[],localStorage.removeItem("postTitle"),localStorage.removeItem("postIntroduction"),localStorage.removeItem("postImages"),localStorage.removeItem("postFileList")},setTitle(e){this.title=e},setIntroduction(e){this.introduction=e},setImages(e){this.images=e},setFileList(e){this.fileList=e},savePost(e,u,d,c){this.setTitle(e),this.setIntroduction(u),this.setImages(d),this.setFileList(c),localStorage.setItem("postTitle",e),localStorage.setItem("postIntroduction",u),localStorage.setItem("postImages",JSON.stringify(d)),localStorage.setItem("postFileList",JSON.stringify(c))},loadPost(){this.title=localStorage.getItem("postTitle")||"",this.introduction=localStorage.getItem("postIntroduction")||"",this.images=JSON.parse(localStorage.getItem("postImages")||"[]"),this.fileList=JSON.parse(localStorage.getItem("postFileList")||"[]")}}});const b=e=>(E("data-v-6993ee72"),e=e(),M(),e),et=b(()=>a("img",{src:j},null,-1)),ot=[et],st={class:"uploader-container"},at=b(()=>a("div",{class:"upload-container"},[a("img",{src:X,class:"upload-icon"})],-1)),it={class:"post-container"},nt={__name:"initiateteam",setup(e){const u=new H,d=K(),c=_("添加路线"),p=_([]),n=_([]),g=_(!1),x=[{name:"繁花路线",icon:"star-o"},{name:"别样外滩",icon:"star-o"},{name:"历史梧桐",icon:"star-o"},{name:"不夜沪上",icon:"star-o"},{name:"轮渡漫游",icon:"star-o"},{name:"取消",icon:"star-o"}],L=s=>{const t=s.index;return t!==void 0&&n.value.splice(t,1),console.log(n.value),!0},U=async s=>{console.log(s),console.log(s.file);try{const t=new FormData;t.append("file",s.file);const i={"introduction-type":"multipart/form-data",session:d.sessionId},f=await u.uploadImage.uploadImageUsingPost(t,i);n.value.push(f.data.result),console.log(n.value)}catch(t){console.error("上传图片时出错:",t),v({type:"danger",message:"上传图片时出错"})}},k=s=>{g.value=!1,c.value=s.name,console.log(c.value)},P=()=>{$.back()},o=C({title:"",introduction:""}),D=async()=>{if(!o.title||!o.introduction)try{await W({title:"警告",message:"标题和正文不能为空。仍要继续发布吗？"}),I()}catch{v({type:"warning",message:"发布已取消"})}else I()},I=async()=>{const s=new FormData;s.append("title",o.title),s.append("introduction",o.introduction),n.value.forEach((i,f)=>{s.append(`photo[${f}]`,i)});const t={session:d.sessionId};try{const i=await u.walkerTeam.createWalkerTeamUsingPost(s,t);console.log(i),o.title="",o.introduction="",n.value=[],p.value=[],m.clearPost(),v({type:"success",message:"发布成功"})}catch(i){console.error(i),v({type:"danger",message:"发布失败"})}},m=tt();N(()=>{m.loadPost(),o.title=m.title,o.introduction=m.introduction,n.value=m.images,p.value=m.fileList});const F=()=>{m.savePost(o.title,o.introduction,n.value,p.value),v({type:"success",message:"草稿已保存"})};return(s,t)=>{const i=q,f=z;return V(),R(O,null,[a("header",null,[a("div",{class:"back-icon",onClick:P},ot)]),a("div",st,[h(i,{modelValue:l(p),"onUpdate:modelValue":t[0]||(t[0]=r=>S(p)?p.value=r:null),multiple:"","max-count":9,"after-read":U,"before-delete":L},{default:A(()=>[at]),_:1},8,["modelValue"])]),a("main",null,[a("div",it,[w(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>l(o).title=r),placeholder:"输入标题",class:"post-title-input"},null,512),[[y,l(o).title]]),w(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=r=>l(o).introduction=r),placeholder:"输入正文",class:"post-introduction-textarea"},null,512),[[y,l(o).introduction]]),a("button",{class:B(["submit-button",{"selected-route":l(c)!=="添加路线"}]),onClick:t[3]||(t[3]=r=>g.value=!0)},J(l(c)),3),h(f,{show:l(g),"onUpdate:show":t[4]||(t[4]=r=>S(g)?g.value=r:null),actions:x,onSelect:k},null,8,["show"])]),a("div",{class:"buttons-container"},[a("img",{src:Y,class:"save-draft-icon",onClick:F}),a("img",{src:Z,class:"submit-post-icon",onClick:D})])]),h(G)],64)}}},Lt=Q(nt,[["__scopeId","data-v-6993ee72"]]);export{Lt as default};
