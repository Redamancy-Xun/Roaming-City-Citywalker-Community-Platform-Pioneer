import{_ as W}from"./Back-31df5cd7.js";/* empty css                                                                   */import{i as u,q as X,s as Y,a as i,c,b as s,t as l,e as w,w as y,F as I,k as B,m as Z,f as ss,l as m,x as b,D as ts,E as os,v as es,r as q,p as A,h as V,y as as,o as is}from"./index-c336339f.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-8fc61471.js";/* empty css              *//* empty css              *//* empty css              */import{_ as ns}from"./delete-3a8265f0.js";import{_ as cs}from"./arrow_right-40db7ce5.js";import{_ as rs}from"./partone-71a19f17.js";import{A as E}from"./Citywalker-5c40621a.js";import{u as T}from"./userStore-afec8895.js";import{a as R}from"./function-call-d16eb335.js";import{S as ls,a as ds}from"./index-0421c015.js";import{I as ps}from"./index-fcfdd17c.js";import{D as _s}from"./index-cec5e97b.js";import"./index-965c857b.js";import"./use-touch-78a9110c.js";import"./use-route-86a7542e.js";import"./index-d6d9cd4a.js";const $=""+new URL("liked-6de882db.svg",import.meta.url).href,D=""+new URL("like-c966ad0b.svg",import.meta.url).href,ms=""+new URL("collected-4fc3b190.svg",import.meta.url).href,us=""+new URL("collect-5aecbd1e.svg",import.meta.url).href,gs=""+new URL("comment-107ba8a8.svg",import.meta.url).href;const k=d=>(A("data-v-2bdd2644"),d=d(),V(),d),hs={class:"container"},ks={class:"title"},vs={class:"invitation"},fs={class:"profile-pic"},ys=["src"],ws={class:"username"},Is=["src","onClick"],Cs={class:"route"},Ps=k(()=>s("img",{src:cs},null,-1)),bs={class:"content"},Ls=k(()=>s("div",{class:"tags"},[s("span",{class:"tag"},"#记录"),s("span",{class:"tag"},"#一起citywalk")],-1)),Us=k(()=>s("div",{class:"divider"},null,-1)),xs={class:"comments"},Ss=["src"],Ns={class:"comment-author"},Bs={class:"comment-content"},Rs={class:"like-section"},$s=["onClick"],Ds=["onClick"],qs={class:"like-count"},As={class:"footer-content"},Vs={class:"textnum"},zs={class:"textnum"},Es=k(()=>s("img",{src:gs,class:"icon"},null,-1)),Ts={class:"textnum"},Fs={class:"custom-dialog"},Gs=k(()=>s("img",{src:rs,class:"dialog-image"},null,-1)),Ms={__name:"community_detail_card",props:{postdata:{type:Object,required:!0}},setup(d){const o=d,r=new E,n=T(),p=u(""),C={1:"繁花路线",2:"历史梧桐",3:"小资愚园",4:"甜爱多伦",5:"不夜沪上",6:"购物天堂",7:"轮渡漫游",8:"都市风光",9:"别样外滩",10:"疗愈滨江",11:"巨富长线",12:"淮海中路"},P=X(()=>C[o.postdata.routeId]||"未知路线"),_=u([]),L=t=>{f.value=t,v.value=!0},v=u(!1),f=u(0),g=u(!1),G=t=>{f.value=t},M=async()=>{if(!p.value.trim())return;const t={content:p.value,postId:o.postdata.id,images:[]},a={session:n.sessionId};try{const h=await r.comment.createCommentUsingPost(t,a);console.log(h),console.log(t),p.value="",await U()}catch(h){console.error(h)}},U=async()=>{try{const t=await r.comment.getCommentListUsingGet({orderByPopularity:!0,page:1,pageSize:10,postId:o.postdata.id},{session:n.sessionId});_.value=t.data.result,console.log(_.value)}catch(t){console.error("Error fetching comments:",t)}};Y(()=>o.postdata.id,(t,a)=>{t!==a&&t&&U()},{immediate:!0});const j=()=>{g.value=!0},O=async()=>{try{const t=await r.post.deletePostUsingPost({postId:o.postdata.id},{session:n.sessionId});console.log("帖子删除成功",t),R({type:"success",message:"帖子删除成功"}),g.value=!1,q.back()}catch(t){console.error("帖子删除失败",t),R({type:"danger",message:"帖子删除失败，请稍后再试"})}},x=async()=>{try{o.postdata.isLike?(await r.like.unlikePostUsingPost({id:o.postdata.id,type:0},{session:n.sessionId}),o.postdata.isLike=!1,o.postdata.likes--):(await r.like.likePostUsingPost({id:o.postdata.id,type:0},{session:n.sessionId}),o.postdata.isLike=!0,o.postdata.likes++)}catch(t){o.postdata.isLike?console.error("取消点赞失败:",t):console.error("点赞帖子失败:",t)}},S=async t=>{try{t.isLike?(await r.like.unlikePostUsingPost({id:t.id,type:1},{session:n.sessionId}),t.isLike=!1,t.likes--):(await r.like.likePostUsingPost({id:t.id,type:1},{session:n.sessionId}),t.isLike=!0,t.likes++)}catch(a){t.isLike?console.error("取消点赞失败:",a):console.error("点赞帖子失败:",a)}},N=async()=>{try{if(o.postdata.isStar){const t=await r.star.unstarPostUsingPost({postId:o.postdata.id},{session:n.sessionId});o.postdata.isStar=!1,o.postdata.stars--}else{const t=await r.star.starPostUsingPost({postId:o.postdata.id},{session:n.sessionId});o.postdata.isStar=!0,o.postdata.stars++}}catch(t){o.postdata.isCollected?console.error("取消收藏帖子失败:",t):console.error("收藏帖子失败:",t)}};return(t,a)=>{const h=ls,H=ds,J=ps,K=_s;return i(),c(I,null,[s("div",hs,[s("header",null,[s("span",ks,l(o.postdata.title),1),s("img",{src:ns,class:"deleteIcon",onClick:j})]),s("main",null,[s("div",vs,[s("div",fs,[s("img",{src:o.postdata.userAvatar,class:"profile"},null,8,ys),s("span",ws,l(o.postdata.userName),1)])]),w(H,{"lazy-render":""},{default:y(()=>[(i(!0),c(I,null,B(o.postdata.images,(e,Q)=>(i(),Z(h,{key:e,class:"zoom"},{default:y(()=>[s("img",{src:e,class:"img",onClick:()=>L(Q)},null,8,Is)]),_:2},1024))),128))]),_:1}),w(J,{show:m(v),"onUpdate:show":a[0]||(a[0]=e=>b(v)?v.value=e:null),images:o.postdata.images,"start-position":m(f),onChange:G},{index:y(()=>[ss("第"+l(m(f)+1)+"页",1)]),_:1},8,["show","images","start-position"]),s("div",Cs,[s("span",null,l(m(P)),1),Ps]),s("div",bs,l(o.postdata.content),1),Ls,Us,s("div",xs,[(i(!0),c(I,null,B(m(_),e=>(i(),c("div",{class:"comment",key:e.id},[s("img",{src:e.userAvatar,class:"comment-avatar"},null,8,Ss),s("span",Ns,l(e.userName),1),s("span",Bs,l(e.content),1),s("div",Rs,[e.isLike?(i(),c("img",{key:0,src:$,class:"comment-like",onClick:()=>S(e)},null,8,$s)):(i(),c("img",{key:1,src:D,class:"comment-like",onClick:()=>S(e)},null,8,Ds)),s("span",qs,l(e.likes),1)])]))),128))])])]),s("div",As,[ts(s("input",{type:"text",placeholder:"发评论...",class:"comment-input","onUpdate:modelValue":a[1]||(a[1]=e=>b(p)?p.value=e:null)},null,512),[[os,m(p)]]),o.postdata.isLike?(i(),c("img",{key:0,src:$,class:"icon",onClick:x})):(i(),c("img",{key:1,src:D,class:"icon",onClick:x})),s("span",Vs,l(o.postdata.likes),1),o.postdata.isStar?(i(),c("img",{key:2,src:ms,class:"icon",onClick:N})):(i(),c("img",{key:3,src:us,class:"icon",onClick:N})),s("span",zs,l(o.postdata.stars),1),Es,s("span",Ts,l(o.postdata.comments),1),m(p)?(i(),c("button",{key:4,class:"send-button",onClick:M},"发送")):es("",!0)]),s("div",Fs,[w(K,{show:m(g),"onUpdate:show":a[2]||(a[2]=e=>b(g)?g.value=e:null),title:"确认要删除这条帖子？","show-cancel-button":"",onConfirm:O},{default:y(()=>[Gs]),_:1},8,["show"])])],64)}}},js=z(Ms,[["__scopeId","data-v-2bdd2644"]]);const F=d=>(A("data-v-b6315909"),d=d(),V(),d),Os=F(()=>s("img",{src:W},null,-1)),Hs=[Os],Js=F(()=>s("span",null,"社区",-1)),Ks={class:"image-container"},Qs={__name:"community_detail",setup(d){const o=T(),r=new E,n=as(),p=u([]),C=()=>{q.back()},P=async()=>{try{const _=await r.post.getPostByIdUsingGet({postId:n.query.id},{session:o.sessionId});console.log(_.data),p.value=_.data.result}catch(_){console.error("获取帖子失败",_)}};return is(()=>{console.log(n.query.id),P()}),(_,L)=>(i(),c(I,null,[s("header",null,[s("div",{class:"back-icon",onClick:C},Hs),Js]),s("main",null,[s("div",Ks,[w(js,{postdata:m(p)},null,8,["postdata"])])])],64))}},kt=z(Qs,[["__scopeId","data-v-b6315909"]]);export{kt as default};
