import{c as j,e as fe,y as he,n as O,m as M,j as A,w as J,z as we,s as ye,t as z,J as Se,x as W,p as U,K as R,M as Ie,u as ne,L as Pe,g as xe,A as N,i as ae,a as be,b as Ce,h as ze,H as ke,r as Te}from"./index-dcd1bf9c.js";import{a as Le,u as le}from"./use-touch-fbe6bb65.js";import{I as se}from"./use-scope-id-02176d93.js";import{S as $e,a as Oe}from"./index-03c1dd54.js";import{P as Re}from"./index-05100a24.js";import{e as c,d as F,m as Z,i as k,K as Ye,A as Y,D as Xe,o as re,z as V,v as Ee,L as Be,B as G,s as ce}from"./index-7421df47.js";const[Ze,_]=j("loading"),De=Array(12).fill(null).map((e,u)=>c("i",{class:_("line",String(u+1))},null)),_e=c("svg",{class:_("circular"),viewBox:"25 25 50 50"},[c("circle",{cx:"50",cy:"50",r:"20",fill:"none"},null)]),Me={size:O,type:M("circular"),color:String,vertical:Boolean,textSize:O,textColor:String};var He=F({name:Ze,props:Me,setup(e,{slots:u}){const m=Z(()=>fe({color:e.color},he(e.size))),o=()=>{const t=e.type==="spinner"?De:_e;return c("span",{class:_("spinner",e.type),style:m.value},[u.icon?u.icon():t])},r=()=>{var t;if(u.default)return c("span",{class:_("text"),style:{fontSize:A(e.textSize),color:(t=e.textColor)!=null?t:e.color}},[u.default()])};return()=>{const{type:t,vertical:v}=e;return c("div",{class:_([t,{vertical:v}]),"aria-live":"polite","aria-busy":!0},[o(),r()])}}});const We=J(He),[Ne,E]=j("image"),Ae={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:O,height:O,radius:O,lazyLoad:Boolean,iconSize:O,showError:z,errorIcon:M("photo-fail"),iconPrefix:String,showLoading:z,loadingIcon:M("photo"),crossorigin:String,referrerpolicy:String};var je=F({name:Ne,props:Ae,emits:["load","error"],setup(e,{emit:u,slots:m}){const o=k(!1),r=k(!0),t=k(),{$Lazyload:v}=Ye().proxy,T=Z(()=>{const i={width:A(e.width),height:A(e.height)};return we(e.radius)&&(i.overflow="hidden",i.borderRadius=A(e.radius)),i});Y(()=>e.src,()=>{o.value=!1,r.value=!0});const g=i=>{r.value&&(r.value=!1,u("load",i))},x=()=>{const i=new Event("load");Object.defineProperty(i,"target",{value:t.value,enumerable:!0}),g(i)},L=i=>{o.value=!0,r.value=!1,u("error",i)},f=(i,w,P)=>P?P():c(se,{name:i,size:e.iconSize,class:w,classPrefix:e.iconPrefix},null),h=()=>{if(r.value&&e.showLoading)return c("div",{class:E("loading")},[f(e.loadingIcon,E("loading-icon"),m.loading)]);if(o.value&&e.showError)return c("div",{class:E("error")},[f(e.errorIcon,E("error-icon"),m.error)])},$=()=>{if(o.value||!e.src)return;const i={alt:e.alt,class:E("img"),style:{objectFit:e.fit,objectPosition:e.position},crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy};return e.lazyLoad?Ee(c("img",G({ref:t},i),null),[[Be("lazy"),e.src]]):c("img",G({ref:t,src:e.src,onLoad:g,onError:L},i),null)},I=({el:i})=>{const w=()=>{i===t.value&&r.value&&x()};t.value?w():V(w)},X=({el:i})=>{i===t.value&&!o.value&&L()};return v&&ye&&(v.$on("loaded",I),v.$on("error",X),Xe(()=>{v.$off("loaded",I),v.$off("error",X)})),re(()=>{V(()=>{var i;(i=t.value)!=null&&i.complete&&!e.lazyLoad&&x()})}),()=>{var i;return c("div",{class:E({round:e.round,block:e.block}),style:T.value},[$(),h(),(i=m.default)==null?void 0:i.call(m)])}}});const Fe=J(je),te=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Ke=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),q=j("image-preview")[1],ie=2.6,Ue={src:String,show:Boolean,active:Number,minZoom:W(O),maxZoom:W(O),rootWidth:W(Number),rootHeight:W(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean};var qe=F({props:Ue,emits:["scale","close","longPress"],setup(e,{emit:u,slots:m}){const o=ce({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),r=Le(),t=k(),v=k(),T=k(!1),g=k(!1);let x=0;const L=Z(()=>{const{scale:a,moveX:n,moveY:l,moving:d,zooming:S,initializing:C}=o,H={transitionDuration:S||d||C?"0s":".3s"};return(a!==1||g.value)&&(H.transform=`matrix(${a}, 0, 0, ${a}, ${n}, ${l})`),H}),f=Z(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:n}=e,l=T.value?n/o.imageRatio:a;return Math.max(0,(o.scale*l-a)/2)}return 0}),h=Z(()=>{if(o.imageRatio){const{rootWidth:a,rootHeight:n}=e,l=T.value?n:a*o.imageRatio;return Math.max(0,(o.scale*l-n)/2)}return 0}),$=(a,n)=>{var l;if(a=R(a,+e.minZoom,+e.maxZoom+1),a!==o.scale){const d=a/o.scale;if(o.scale=a,n){const S=ne((l=t.value)==null?void 0:l.$el),C={x:S.width*.5,y:S.height*.5},H=o.moveX-(n.x-S.left-C.x)*(d-1),ge=o.moveY-(n.y-S.top-C.y)*(d-1);o.moveX=R(H,-f.value,f.value),o.moveY=R(ge,-h.value,h.value)}else o.moveX=0,o.moveY=g.value?x:0;u("scale",{scale:a,index:e.active})}},I=()=>{$(1)},X=()=>{const a=o.scale>1?1:2;$(a,a===2||g.value?{x:r.startX.value,y:r.startY.value}:void 0)};let i,w,P,s,b,y,D,Q,K=!1;const ue=a=>{const{touches:n}=a;if(i=n.length,i===2&&e.disableZoom)return;const{offsetX:l}=r;r.start(a),w=o.moveX,P=o.moveY,Q=Date.now(),K=!1,o.moving=i===1&&(o.scale!==1||g.value),o.zooming=i===2&&!l.value,o.zooming&&(s=o.scale,b=te(n))},me=a=>{const{touches:n}=a;if(r.move(a),o.moving){const{deltaX:l,deltaY:d}=r,S=l.value+w,C=d.value+P;if((e.vertical?r.isVertical()&&Math.abs(C)>h.value:r.isHorizontal()&&Math.abs(S)>f.value)&&!K){o.moving=!1;return}K=!0,U(a,!0),o.moveX=R(S,-f.value,f.value),o.moveY=R(C,-h.value,h.value)}if(o.zooming&&(U(a,!0),n.length===2)){const l=te(n),d=s*l/b;y=Ke(n),$(d,y)}},p=a=>{var n;const l=(n=v.value)==null?void 0:n.$el,d=l.firstElementChild,S=a.target===l,C=d==null?void 0:d.contains(a.target);!e.closeOnClickImage&&C||!e.closeOnClickOverlay&&S||u("close")},ve=a=>{if(i>1)return;const n=Date.now()-Q,l=250;r.isTap.value&&(n<l?e.doubleScale?D?(clearTimeout(D),D=null,X()):D=setTimeout(()=>{p(a),D=null},l):p(a):n>Pe&&u("longPress"))},ee=a=>{let n=!1;if((o.moving||o.zooming)&&(n=!0,o.moving&&w===o.moveX&&P===o.moveY&&(n=!1),!a.touches.length)){o.zooming&&(o.moveX=R(o.moveX,-f.value,f.value),o.moveY=R(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,w=0,P=0,s=1,o.scale<1&&I();const l=+e.maxZoom;o.scale>l&&$(l,y)}U(a,n),ve(a),r.reset()},oe=()=>{const{rootWidth:a,rootHeight:n}=e,l=n/a,{imageRatio:d}=o;T.value=o.imageRatio>l&&d<ie,g.value=o.imageRatio>l&&d>=ie,g.value&&(x=(d*a-n)/2,o.moveY=x,o.initializing=!0,Ie(()=>{o.initializing=!1})),I()},de=a=>{const{naturalWidth:n,naturalHeight:l}=a.target;o.imageRatio=l/n,oe()};return Y(()=>e.active,I),Y(()=>e.show,a=>{a||I()}),Y(()=>[e.rootWidth,e.rootHeight],oe),Se("touchmove",me,{target:Z(()=>{var a;return(a=v.value)==null?void 0:a.$el})}),le({resetScale:I}),()=>{const a={loading:()=>c(We,{type:"spinner"},null)};return c($e,{ref:v,class:q("swipe-item"),onTouchstartPassive:ue,onTouchend:ee,onTouchcancel:ee},{default:()=>[m.image?c("div",{class:q("image-wrap")},[m.image({src:e.src})]):c(Fe,{ref:t,src:e.src,fit:"contain",class:q("image",{vertical:T.value}),style:L.value,onLoad:de},a)]})}}});const[Ve,B]=j("image-preview"),Ge=["show","teleport","transition","overlayStyle","closeOnPopstate"],Je={show:Boolean,loop:z,images:xe(),minZoom:N(1/3),maxZoom:N(3),overlay:z,vertical:Boolean,closeable:Boolean,showIndex:z,className:ae,closeIcon:M("clear"),transition:String,beforeClose:Function,doubleScale:z,overlayClass:ae,overlayStyle:Object,swipeDuration:N(300),startPosition:N(0),showIndicators:Boolean,closeOnPopstate:z,closeOnClickImage:z,closeOnClickOverlay:z,closeIconPosition:M("top-right"),teleport:[String,Object]};var Qe=F({name:Ve,props:Je,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:u,slots:m}){const o=k(),r=k(),t=ce({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),v=()=>{if(o.value){const s=ne(o.value.$el);t.rootWidth=s.width,t.rootHeight=s.height,o.value.resize()}},T=s=>u("scale",s),g=s=>u("update:show",s),x=()=>{Te(e.beforeClose,{args:[t.active],done:()=>g(!1)})},L=s=>{s!==t.active&&(t.active=s,u("change",s))},f=()=>{if(e.showIndex)return c("div",{class:B("index")},[m.index?m.index({index:t.active}):`${t.active+1} / ${e.images.length}`])},h=()=>{if(m.cover)return c("div",{class:B("cover")},[m.cover()])},$=()=>{t.disableZoom=!0},I=()=>{t.disableZoom=!1},X=()=>c(Oe,{ref:o,lazyRender:!0,loop:e.loop,class:B("swipe"),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:L,onDragEnd:I,onDragStart:$},{default:()=>[e.images.map((s,b)=>c(qe,{ref:y=>{b===t.active&&(r.value=y)},src:s,show:e.show,active:t.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:t.rootWidth,rootHeight:t.rootHeight,disableZoom:t.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:T,onClose:x,onLongPress:()=>u("longPress",{index:b})},{image:m.image}))]}),i=()=>{if(e.closeable)return c(se,{role:"button",name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),ke],onClick:x},null)},w=()=>u("closed"),P=(s,b)=>{var y;return(y=o.value)==null?void 0:y.swipeTo(s,b)};return le({resetScale:()=>{var s;(s=r.value)==null||s.resetScale()},swipeTo:P}),re(v),Y([be,Ce],v),Y(()=>e.startPosition,s=>L(+s)),Y(()=>e.show,s=>{const{images:b,startPosition:y}=e;s?(L(+y),V(()=>{v(),P(+y,{immediate:!0})})):u("close",{index:t.active,url:b[t.active]})}),()=>c(Re,G({class:[B(),e.className],overlayClass:[B("overlay"),e.overlayClass],onClosed:w,"onUpdate:show":g},ze(e,Ge)),{default:()=>[i(),X(),f(),h()]})}});const no=J(Qe);export{no as I,We as L,Fe as a,Qe as s};
