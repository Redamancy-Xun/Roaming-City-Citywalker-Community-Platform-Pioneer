import{i,q,s as z,o as O,c as m,b as s,f as V,t as y,l as n,F as A,k as j,v as H,e as v,w as C,x as b,r as J,a as d,m as K,p as Q,h as W}from"./index-c336339f.js";import"./index-8fc61471.js";/* empty css              */import{s as X,C as Y}from"./index-30cdb3de.js";import"./index-832b6491.js";import{_ as Z}from"./Back-31df5cd7.js";import{_ as ee}from"./delete-3a8265f0.js";import{_ as x}from"./partone-71a19f17.js";import{_ as oe}from"./footer.vue_vue_type_script_setup_true_lang-d3470474.js";import{A as se}from"./Citywalker-5c40621a.js";import{u as te}from"./userStore-afec8895.js";import{_ as ae}from"./parttwo-e8c99a7b.js";import{_ as ne}from"./_plugin-vue_export-helper-c27b6911.js";import{s as le,a as u}from"./function-call-d16eb335.js";import{w as B}from"./use-touch-78a9110c.js";import{D as re}from"./index-cec5e97b.js";import"./index-965c857b.js";import"./use-route-86a7542e.js";import"./index-d6d9cd4a.js";/* empty css                                                                   */const ce=B(X);B(le);const ie=""+new URL("selectedorange-8d7ce058.svg",import.meta.url).href,de=""+new URL("unselectedorange-3dc25730.svg",import.meta.url).href;const f=_=>(Q("data-v-0a07f495"),_=_(),W(),_),ue=f(()=>s("img",{src:Z},null,-1)),pe=[ue],me={class:"image-container"},_e=["src","alt"],ge={class:"choosebox"},he=["onClick"],ve={key:0,class:"fixed-bottom"},fe={class:"selection-container"},Ie=f(()=>s("span",null,"全选",-1)),we=["src"],ke={class:"computed-total"},ye={class:"total-num"},Ce={class:"total-price"},be={class:"custom-dialog"},xe=f(()=>s("img",{src:x,class:"dialog-image"},null,-1)),Se={class:"custom-dialog"},Ue=f(()=>s("img",{src:x,class:"dialog-image"},null,-1)),De={__name:"shopping_cart",setup(_){const a=i([]),t=i([]),I=te(),w=new se,g=i(!1),h=i(!1),p=i(!1),r=i(null),N=()=>{t.value.length===0?u({type:"warning",message:"您还没有选择路线"}):h.value=!0},$=()=>{g.value=!g.value},E=q(()=>t.value.reduce((e,o)=>{const c=a.value.find(k=>k.orderId===o);return c?e+c.routeCost:e},0));z(t,(e,o)=>{console.log(t.value),console.log("Checked values changed:",e),console.log("Previous values were:",o)});const S=async()=>{try{const e=await w.shoppingCart.showShoppingCartUsingGet({page:1,pageSize:100},{session:I.sessionId});e.data&&e.data.result&&Array.isArray(e.data.result.items)?(a.value=e.data.result.items,t.value=a.value.map(o=>o.id).filter(o=>o!=null),console.log("购物车数据:",a.value)):(console.error("购物车数据为空或格式不正确:",e.data),a.value=[],t.value=[])}catch(e){console.error("获取购物车数据失败",e)}},L=()=>{t.value.length===a.value.length?t.value=[]:t.value=a.value.map(e=>e.orderId)},M=()=>{u({type:"danger",message:"订单已取消"})},P=async()=>{try{const e=a.value.filter(o=>t.value.includes(o.orderId));for(const o of e){const c=await w.shoppingCart.buyShoppingCartUsingPost({orderId:o.orderId},{session:I.sessionId});console.log("购买成功",c),u({type:"success",message:"购买成功"})}t.value=[],S()}catch(e){console.error("购买失败",e),u({type:"danger",message:"购买失败"})}};O(S);const R=()=>{J.back()},F=e=>{switch(e){case 1:return x;case 9:return ae}},G=e=>{r.value=e,p.value=!0},T=async()=>{if(r.value)try{await w.shoppingCart.deleteShoppingCartUsingPost({orderId:r.value.orderId},{session:I.sessionId});const e=a.value.findIndex(o=>o.orderId===r.value.orderId);if(e!==-1){a.value.splice(e,1);const o=t.value.indexOf(r.value.orderId);o!==-1&&t.value.splice(o,1),u({type:"success",message:"路线已成功删除"})}r.value=null,p.value=!1}catch(e){console.error("删除失败",e),u({type:"danger",message:"删除失败，请稍后再试"})}};return(e,o)=>{const c=Y,k=ce,U=re;return d(),m(A,null,[s("header",null,[s("div",{class:"back-icon",onClick:R},pe),V(" 购物车 "),s("div",{class:"post-button",onClick:$},y(n(g)?"取消编辑":"编辑"),1)]),s("main",null,[s("div",me,[(d(!0),m(A,null,j(n(a),l=>(d(),m("div",{class:"part-container",key:l.id},[s("img",{src:F(l.route.routeId),alt:`route${l.route.routeId}`},null,8,_e),s("div",ge,[n(g)?(d(),m("img",{key:1,src:ee,onClick:D=>G(l)},null,8,he)):(d(),K(k,{key:0,modelValue:n(t),"onUpdate:modelValue":o[0]||(o[0]=D=>b(t)?t.value=D:null)},{default:C(()=>[v(c,{name:l.orderId,value:l},null,8,["name","value"])]),_:2},1032,["modelValue"]))])]))),128))])]),n(a).length>0?(d(),m("div",ve,[s("div",fe,[Ie,s("img",{src:n(t).length===n(a).length?n(ie):n(de),onClick:L},null,8,we)]),s("div",ke,[s("span",ye," 已选"+y(n(t).length)+"件, ",1),s("span",null,[V(" 合计 "),s("span",Ce,y(n(E))+"元",1)])]),s("button",{class:"submit-button",onClick:N},"结算")])):H("",!0),s("div",be,[v(U,{show:n(p),"onUpdate:show":o[1]||(o[1]=l=>b(p)?p.value=l:null),title:"是否要删除以下路线","show-cancel-button":"",onConfirm:T},{default:C(()=>[xe]),_:1},8,["show"])]),s("div",Se,[v(U,{show:n(h),"onUpdate:show":o[2]||(o[2]=l=>b(h)?h.value=l:null),title:"是否要购买以下路线","show-cancel-button":"",onCancel:M,onConfirm:P},{default:C(()=>[Ue]),_:1},8,["show"])]),v(oe)],64)}}},Qe=ne(De,[["__scopeId","data-v-0a07f495"]]);export{Qe as default};
