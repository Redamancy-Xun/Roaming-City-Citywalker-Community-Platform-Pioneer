import{I as F}from"./use-scope-id-02176d93.js";import{p as ce,a as ue,P as de}from"./index-05100a24.js";import{L as Z,s as Re,a as Te}from"./index-1a41a3f5.js";import{a as De,b as Oe,u as Ue,c as V,d as ze,t as A,w as j,e as R,m as I,n as X,B as Fe,p as $e,f as Le,g as fe,h as _,H as _e,i as Ee,j as Ve,k as ne,l as me,o as Ne,q as je,r as ge,s as ve,v as he,x as He,y as be,z as Ke,A as te,C as Me,D as qe}from"./index-dcd1bf9c.js";import{i as E,o as We,z as q,A as Ge,e as t,d as $,m as ae,B as H,s as we,C as Ze,D as Xe,v as oe,E as le}from"./index-7421df47.js";import{m as Be,u as ye}from"./function-call-eaca0cc0.js";import{r as Ce,u as pe}from"./use-route-2e53a763.js";import{o as Ye,u as ke}from"./use-touch-fbe6bb65.js";const Je=(e,n)=>{const a=E(),i=()=>{a.value=Ue(e).height};return We(()=>{if(q(i),n)for(let s=1;s<=3;s++)setTimeout(i,100*s)}),Ye(()=>q(i)),Ge([De,Oe],i),a};function Qe(e,n){const a=Je(e,!0);return i=>t("div",{class:n("placeholder"),style:{height:a.value?`${a.value}px`:void 0}},[i()])}const[Pe,ie]=V("action-bar"),xe=Symbol(Pe),en={placeholder:Boolean,safeAreaInsetBottom:A};var nn=$({name:Pe,props:en,setup(e,{slots:n}){const a=E(),i=Qe(a,ie),{linkChildren:s}=ze(xe);s();const m=()=>{var w;return t("div",{ref:a,class:[ie(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(w=n.default)==null?void 0:w.call(n)])};return()=>e.placeholder?i(m):m()}});const tn=j(nn),[an,L]=V("button"),on=R({},Ce,{tag:I("button"),text:String,icon:String,type:I("default"),size:I("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:I("button"),loadingSize:X,loadingText:String,loadingType:String,iconPosition:I("left")});var ln=$({name:an,props:on,emits:["click"],setup(e,{emit:n,slots:a}){const i=pe(),s=()=>a.loading?a.loading():t(Z,{size:e.loadingSize,type:e.loadingType,class:L("loading")},null),m=()=>{if(e.loading)return s();if(a.icon)return t("div",{class:L("icon")},[a.icon()]);if(e.icon)return t(F,{name:e.icon,class:L("icon"),classPrefix:e.iconPrefix},null)},w=()=>{let u;if(e.loading?u=e.loadingText:u=a.default?a.default():e.text,u)return t("span",{class:L("text")},[u])},f=()=>{const{color:u,plain:r}=e;if(u){const o={color:r?u:"white"};return r||(o.background=u),u.includes("gradient")?o.border=0:o.borderColor=u,o}},B=u=>{e.loading?$e(u):e.disabled||(n("click",u),i())};return()=>{const{tag:u,type:r,size:o,block:g,round:b,plain:k,square:D,loading:O,disabled:c,hairline:v,nativeType:P,iconPosition:C}=e,T=[L([r,o,{plain:k,block:g,round:b,square:D,loading:O,disabled:c,hairline:v}]),{[Fe]:v}];return t(u,{type:P,class:T,style:f(),disabled:c,onClick:B},{default:()=>[t("div",{class:L("content")},[C==="left"&&m(),w(),C==="right"&&m()])]})}}});const W=j(ln),[rn,sn]=V("action-bar-button"),cn=R({},Ce,{type:String,text:String,icon:String,color:String,loading:Boolean,disabled:Boolean});var un=$({name:rn,props:cn,setup(e,{slots:n}){const a=pe(),{parent:i,index:s}=Le(xe),m=ae(()=>{if(i){const f=i.children[s.value-1];return!(f&&"isButton"in f)}}),w=ae(()=>{if(i){const f=i.children[s.value+1];return!(f&&"isButton"in f)}});return ke({isButton:!0}),()=>{const{type:f,icon:B,text:u,color:r,loading:o,disabled:g}=e;return t(W,{class:sn([f,{last:w.value,first:m.value}]),size:"large",type:f,icon:B,color:r,loading:o,disabled:g,onClick:a},{default:()=>[n.default?n.default():u]})}}});const re=j(un),[dn,x]=V("action-sheet"),fn=R({},ce,{title:String,round:A,actions:fe(),closeIcon:I("cross"),closeable:A,cancelText:String,description:String,closeOnPopstate:A,closeOnClickAction:Boolean,safeAreaInsetBottom:A}),mn=[...ue,"round","closeOnPopstate","safeAreaInsetBottom"];var gn=$({name:dn,props:fn,emits:["select","cancel","update:show"],setup(e,{slots:n,emit:a}){const i=o=>a("update:show",o),s=()=>{i(!1),a("cancel")},m=()=>{if(e.title)return t("div",{class:x("header")},[e.title,e.closeable&&t(F,{name:e.closeIcon,class:[x("close"),_e],onClick:s},null)])},w=()=>{if(n.cancel||e.cancelText)return[t("div",{class:x("gap")},null),t("button",{type:"button",class:x("cancel"),onClick:s},[n.cancel?n.cancel():e.cancelText])]},f=o=>{if(o.icon)return t(F,{class:x("item-icon"),name:o.icon},null)},B=(o,g)=>o.loading?t(Z,{class:x("loading-icon")},null):n.action?n.action({action:o,index:g}):[t("span",{class:x("name")},[o.name]),o.subname&&t("div",{class:x("subname")},[o.subname])],u=(o,g)=>{const{color:b,loading:k,callback:D,disabled:O,className:c}=o,v=()=>{O||k||(D&&D(o),e.closeOnClickAction&&i(!1),q(()=>a("select",o,g)))};return t("button",{type:"button",style:{color:b},class:[x("item",{loading:k,disabled:O}),c],onClick:v},[f(o),B(o,g)])},r=()=>{if(e.description||n.description){const o=n.description?n.description():e.description;return t("div",{class:x("description")},[o])}};return()=>t(de,H({class:x(),position:"bottom","onUpdate:show":i},_(e,mn)),{default:()=>{var o;return[m(),r(),t("div",{class:x("content")},[e.actions.map(u),(o=n.default)==null?void 0:o.call(n)]),w()]}})}});const jn=j(gn),[vn,S,K]=V("dialog"),hn=R({},ce,{title:String,theme:String,width:X,message:[String,Function],callback:Function,allowHtml:Boolean,className:Ee,transition:I("van-dialog-bounce"),messageAlign:String,closeOnPopstate:A,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:A,closeOnClickOverlay:Boolean}),bn=[...ue,"transition","closeOnPopstate"];var wn=$({name:vn,props:hn,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:n,slots:a}){const i=E(),s=we({confirm:!1,cancel:!1}),m=c=>n("update:show",c),w=c=>{var v;m(!1),(v=e.callback)==null||v.call(e,c)},f=c=>()=>{e.show&&(n(c),e.beforeClose?(s[c]=!0,ge(e.beforeClose,{args:[c],done(){w(c),s[c]=!1},canceled(){s[c]=!1}})):w(c))},B=f("cancel"),u=f("confirm"),r=Ze(c=>{var v,P;if(c.target!==((P=(v=i.value)==null?void 0:v.popupRef)==null?void 0:P.value))return;({Enter:e.showConfirmButton?u:ne,Escape:e.showCancelButton?B:ne})[c.key](),n("keydown",c)},["enter","esc"]),o=()=>{const c=a.title?a.title():e.title;if(c)return t("div",{class:S("header",{isolated:!e.message&&!a.default})},[c])},g=c=>{const{message:v,allowHtml:P,messageAlign:C}=e,T=S("message",{"has-title":c,[C]:C}),N=me(v)?v():v;return P&&typeof N=="string"?t("div",{class:T,innerHTML:N},null):t("div",{class:T},[N])},b=()=>{if(a.default)return t("div",{class:S("content")},[a.default()]);const{title:c,message:v,allowHtml:P}=e;if(v){const C=!!(c||a.title);return t("div",{key:P?1:0,class:S("content",{isolated:!C})},[g(C)])}},k=()=>t("div",{class:[je,S("footer")]},[e.showCancelButton&&t(W,{size:"large",text:e.cancelButtonText||K("cancel"),class:S("cancel"),style:{color:e.cancelButtonColor},loading:s.cancel,disabled:e.cancelButtonDisabled,onClick:B},null),e.showConfirmButton&&t(W,{size:"large",text:e.confirmButtonText||K("confirm"),class:[S("confirm"),{[Ne]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:s.confirm,disabled:e.confirmButtonDisabled,onClick:u},null)]),D=()=>t(tn,{class:S("footer")},{default:()=>[e.showCancelButton&&t(re,{type:"warning",text:e.cancelButtonText||K("cancel"),class:S("cancel"),color:e.cancelButtonColor,loading:s.cancel,disabled:e.cancelButtonDisabled,onClick:B},null),e.showConfirmButton&&t(re,{type:"danger",text:e.confirmButtonText||K("confirm"),class:S("confirm"),color:e.confirmButtonColor,loading:s.confirm,disabled:e.confirmButtonDisabled,onClick:u},null)]}),O=()=>a.footer?a.footer():e.theme==="round-button"?D():k();return()=>{const{width:c,title:v,theme:P,message:C,className:T}=e;return t(de,H({ref:i,role:"dialog",class:[S([P]),T],style:{width:Ve(c)},tabindex:0,"aria-labelledby":v||C,onKeydown:r,"onUpdate:show":m},_(e,bn)),{default:()=>[o(),b(),O()]})}}});let G;const Bn={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let yn=R({},Bn);function Cn(){({instance:G}=Be({setup(){const{state:n,toggle:a}=ye();return()=>t(wn,H(n,{"onUpdate:show":a}),null)}}))}function pn(e){return ve?new Promise((n,a)=>{G||Cn(),G.open(R({},yn,e,{callback:i=>{(i==="confirm"?n:a)(i)}}))}):Promise.resolve(void 0)}const Hn=e=>pn(R({showCancelButton:!0},e));let M;const kn={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Pn(){({instance:M}=Be({setup(){const{state:e,toggle:n}=ye(),a=()=>{e.images=[]};return()=>t(Re,H(e,{onClosed:a,"onUpdate:show":n}),null)}}))}const xn=(e,n=0)=>{if(ve)return M||Pn(),e=Array.isArray(e)?{images:e,startPosition:n}:e,M.open(R({},kn,e)),M},[Sn,h,In]=V("uploader");function se(e,n){return new Promise(a=>{if(n==="file"){a();return}const i=new FileReader;i.onload=s=>{a(s.target.result)},n==="dataUrl"?i.readAsDataURL(e):n==="text"&&i.readAsText(e)})}function Se(e,n){return he(e).some(a=>a.file?me(n)?n(a.file):a.file.size>+n:!1)}function An(e,n){const a=[],i=[];return e.forEach(s=>{Se(s,n)?i.push(s):a.push(s)}),{valid:a,invalid:i}}const Rn=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Tn=e=>Rn.test(e);function Ie(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Tn(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Dn=$({props:{name:X,item:He(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:a}){const i=()=>{const{status:r,message:o}=e.item;if(r==="uploading"||r==="failed"){const g=r==="failed"?t(F,{name:"close",class:h("mask-icon")},null):t(Z,{class:h("loading")},null),b=Ke(o)&&o!=="";return t("div",{class:h("mask")},[g,b&&t("div",{class:h("mask-message")},[o])])}},s=r=>{const{name:o,item:g,index:b,beforeDelete:k}=e;r.stopPropagation(),ge(k,{args:[g,{name:o,index:b}],done:()=>n("delete")})},m=()=>n("preview"),w=()=>n("reupload"),f=()=>{if(e.deletable&&e.item.status!=="uploading"){const r=a["preview-delete"];return t("div",{role:"button",class:h("preview-delete",{shadow:!r}),tabindex:0,"aria-label":In("delete"),onClick:s},[r?r():t(F,{name:"cross",class:h("preview-delete-icon")},null)])}},B=()=>{if(a["preview-cover"]){const{index:r,item:o}=e;return t("div",{class:h("preview-cover")},[a["preview-cover"](R({index:r},o))])}},u=()=>{const{item:r,lazyLoad:o,imageFit:g,previewSize:b,reupload:k}=e;return Ie(r)?t(Te,{fit:g,src:r.objectUrl||r.content||r.url,class:h("preview-image"),width:Array.isArray(b)?b[0]:b,height:Array.isArray(b)?b[1]:b,lazyLoad:o,onClick:k?w:m},{default:B}):t("div",{class:h("file"),style:be(e.previewSize)},[t(F,{class:h("file-icon"),name:"description"},null),t("div",{class:[h("file-name"),"van-ellipsis"]},[r.file?r.file.name:r.url]),B()])};return()=>t("div",{class:h("preview")},[u(),i(),f()])}});const On={name:te(""),accept:I("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:te(1/0),imageFit:I("cover"),resultType:I("dataUrl"),uploadIcon:I("photograph"),uploadText:String,deletable:A,reupload:Boolean,afterRead:Function,showUpload:A,modelValue:fe(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:A,previewOptions:Object,previewFullImage:A,maxSize:{type:[Number,String,Function],default:1/0}};var Un=$({name:Sn,props:On,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:a}){const i=E(),s=[],m=E(-1),w=E(!1),f=(l=e.modelValue.length)=>({name:e.name,index:l}),B=()=>{i.value&&(i.value.value="")},u=l=>{if(B(),Se(l,e.maxSize))if(Array.isArray(l)){const d=An(l,e.maxSize);if(l=d.valid,n("oversize",d.invalid,f()),!l.length)return}else{n("oversize",l,f());return}if(l=we(l),m.value>-1){const d=[...e.modelValue];d.splice(m.value,1,l),n("update:modelValue",d),m.value=-1}else n("update:modelValue",[...e.modelValue,...he(l)]);e.afterRead&&e.afterRead(l,f())},r=l=>{const{maxCount:d,modelValue:p,resultType:y}=e;if(Array.isArray(l)){const U=+d-p.length;l.length>U&&(l=l.slice(0,U)),Promise.all(l.map(z=>se(z,y))).then(z=>{const Ae=l.map((J,Q)=>{const ee={file:J,status:"",message:"",objectUrl:URL.createObjectURL(J)};return z[Q]&&(ee.content=z[Q]),ee});u(Ae)})}else se(l,y).then(U=>{const z={file:l,status:"",message:"",objectUrl:URL.createObjectURL(l)};U&&(z.content=U),u(z)})},o=l=>{const{files:d}=l.target;if(e.disabled||!d||!d.length)return;const p=d.length===1?d[0]:[].slice.call(d);if(e.beforeRead){const y=e.beforeRead(p,f());if(!y){B();return}if(qe(y)){y.then(U=>{r(U||p)}).catch(B);return}}r(p)};let g;const b=()=>n("closePreview"),k=l=>{if(e.previewFullImage){const d=e.modelValue.filter(Ie),p=d.map(y=>(y.objectUrl&&!y.url&&y.status!=="failed"&&(y.url=y.objectUrl,s.push(y.url)),y.url)).filter(Boolean);g=xn(R({images:p,startPosition:d.indexOf(l),onClose:b},e.previewOptions))}},D=()=>{g&&g.close()},O=(l,d)=>{const p=e.modelValue.slice(0);p.splice(d,1),n("update:modelValue",p),n("delete",l,f(d))},c=l=>{w.value=!0,m.value=l,q(()=>Y())},v=()=>{w.value||(m.value=-1),w.value=!1},P=(l,d)=>{const p=["imageFit","deletable","reupload","previewSize","beforeDelete"],y=R(_(e,p),_(l,p,!0));return t(Dn,H({item:l,index:d,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",l,f(d)),onDelete:()=>O(l,d),onPreview:()=>k(l),onReupload:()=>c(d)},_(e,["name","lazyLoad"]),y),_(a,["preview-cover","preview-delete"]))},C=()=>{if(e.previewImage)return e.modelValue.map(P)},T=l=>n("clickUpload",l),N=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const l=e.modelValue.length>=+e.maxCount&&e.reupload,d=e.readonly?null:t("input",{ref:i,type:"file",class:h("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&m.value===-1,disabled:e.disabled,onChange:o,onClick:v},null);return a.default?oe(t("div",{class:h("input-wrapper"),onClick:T},[a.default(),d]),[[le,!l]]):oe(t("div",{class:h("upload",{readonly:e.readonly}),style:be(e.previewSize),onClick:T},[t(F,{name:e.uploadIcon,class:h("upload-icon")},null),e.uploadText&&t("span",{class:h("upload-text")},[e.uploadText]),d]),[[le,e.showUpload&&!l]])},Y=()=>{i.value&&!e.disabled&&i.value.click()};return Xe(()=>{s.forEach(l=>URL.revokeObjectURL(l))}),ke({chooseFile:Y,closeImagePreview:D}),Me(()=>e.modelValue),()=>t("div",{class:h()},[t("div",{class:h("wrapper",{disabled:e.disabled})},[C(),N()])])}});const Kn=j(Un);export{jn as A,Kn as U,Hn as a,wn as s};
