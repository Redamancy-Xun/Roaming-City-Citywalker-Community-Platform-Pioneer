import{p as ce,a as ue,P as de,I as A}from"./index-965c857b.js";import{L as W}from"./index-d6d9cd4a.js";import{c as Z,e as P,t as y,m as q,a as U,p as x,H as fe,w as X,i as J,b as Q,d as me,n as ve,f as ge,g as Y,h as pe,j as we,k as H,u as be,l as he,o as Ce}from"./use-touch-78a9110c.js";import{d as j,e as t,G as R,n as ee,i as L,H as ye,D as M,I as G,C as Pe}from"./index-c336339f.js";import{m as ae,u as ne}from"./function-call-d16eb335.js";import{s as Ie}from"./index-8fc61471.js";import{s as ke,a as Se}from"./index-fcfdd17c.js";const[Ae,g]=Z("action-sheet"),Ue=P({},ce,{title:String,round:y,actions:q(),closeIcon:U("cross"),closeable:y,cancelText:String,description:String,closeOnPopstate:y,closeOnClickAction:Boolean,safeAreaInsetBottom:y}),xe=[...ue,"round","closeOnPopstate","safeAreaInsetBottom"];var Be=j({name:Ae,props:Ue,emits:["select","cancel","update:show"],setup(e,{slots:n,emit:o}){const s=l=>o("update:show",l),m=()=>{s(!1),o("cancel")},p=()=>{if(e.title)return t("div",{class:g("header")},[e.title,e.closeable&&t(A,{name:e.closeIcon,class:[g("close"),fe],onClick:m},null)])},I=()=>{if(n.cancel||e.cancelText)return[t("div",{class:g("gap")},null),t("button",{type:"button",class:g("cancel"),onClick:m},[n.cancel?n.cancel():e.cancelText])]},w=l=>{if(l.icon)return t(A,{class:g("item-icon"),name:l.icon},null)},b=(l,d)=>l.loading?t(W,{class:g("loading-icon")},null):n.action?n.action({action:l,index:d}):[t("span",{class:g("name")},[l.name]),l.subname&&t("div",{class:g("subname")},[l.subname])],S=(l,d)=>{const{color:f,loading:h,callback:B,disabled:O,className:D}=l,z=()=>{O||h||(B&&B(l),e.closeOnClickAction&&s(!1),ee(()=>o("select",l,d)))};return t("button",{type:"button",style:{color:f},class:[g("item",{loading:h,disabled:O}),D],onClick:z},[w(l),b(l,d)])},i=()=>{if(e.description||n.description){const l=n.description?n.description():e.description;return t("div",{class:g("description")},[l])}};return()=>t(de,R({class:g(),position:"bottom","onUpdate:show":s},x(e,xe)),{default:()=>{var l;return[p(),i(),t("div",{class:g("content")},[e.actions.map(S),(l=n.default)==null?void 0:l.call(n)]),I()]}})}});const Qe=X(Be);let V;const Oe={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Fe=P({},Oe);function Re(){({instance:V}=ae({setup(){const{state:n,toggle:o}=ne();return()=>t(Ie,R(n,{"onUpdate:show":o}),null)}}))}function De(e){return J?new Promise((n,o)=>{V||Re(),V.open(P({},Fe,e,{callback:s=>{(s==="confirm"?n:o)(s)}}))}):Promise.resolve(void 0)}const Ye=e=>De(P({showCancelButton:!0},e));let F;const ze={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,vertical:!1,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,doubleScale:!0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeOnClickOverlay:!0,closeIconPosition:"top-right"};function Le(){({instance:F}=ae({setup(){const{state:e,toggle:n}=ne(),o=()=>{e.images=[]};return()=>t(ke,R(e,{onClosed:o,"onUpdate:show":n}),null)}}))}const Ve=(e,n=0)=>{if(J)return F||Le(),e=Array.isArray(e)?{images:e,startPosition:n}:e,F.open(P({},ze,e)),F},[je,c,Te]=Z("uploader");function K(e,n){return new Promise(o=>{if(n==="file"){o();return}const s=new FileReader;s.onload=m=>{o(m.target.result)},n==="dataUrl"?s.readAsDataURL(e):n==="text"&&s.readAsText(e)})}function te(e,n){return Q(e).some(o=>o.file?me(n)?n(o.file):o.file.size>+n:!1)}function Ne(e,n){const o=[],s=[];return e.forEach(m=>{te(m,n)?s.push(m):o.push(m)}),{valid:o,invalid:s}}const Ee=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,_e=e=>Ee.test(e);function le(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?_e(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var $e=j({props:{name:ve,item:ge(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,reupload:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview","reupload"],setup(e,{emit:n,slots:o}){const s=()=>{const{status:i,message:l}=e.item;if(i==="uploading"||i==="failed"){const d=i==="failed"?t(A,{name:"close",class:c("mask-icon")},null):t(W,{class:c("loading")},null),f=pe(l)&&l!=="";return t("div",{class:c("mask")},[d,f&&t("div",{class:c("mask-message")},[l])])}},m=i=>{const{name:l,item:d,index:f,beforeDelete:h}=e;i.stopPropagation(),we(h,{args:[d,{name:l,index:f}],done:()=>n("delete")})},p=()=>n("preview"),I=()=>n("reupload"),w=()=>{if(e.deletable&&e.item.status!=="uploading"){const i=o["preview-delete"];return t("div",{role:"button",class:c("preview-delete",{shadow:!i}),tabindex:0,"aria-label":Te("delete"),onClick:m},[i?i():t(A,{name:"cross",class:c("preview-delete-icon")},null)])}},b=()=>{if(o["preview-cover"]){const{index:i,item:l}=e;return t("div",{class:c("preview-cover")},[o["preview-cover"](P({index:i},l))])}},S=()=>{const{item:i,lazyLoad:l,imageFit:d,previewSize:f,reupload:h}=e;return le(i)?t(Se,{fit:d,src:i.objectUrl||i.content||i.url,class:c("preview-image"),width:Array.isArray(f)?f[0]:f,height:Array.isArray(f)?f[1]:f,lazyLoad:l,onClick:h?I:p},{default:b}):t("div",{class:c("file"),style:Y(e.previewSize)},[t(A,{class:c("file-icon"),name:"description"},null),t("div",{class:[c("file-name"),"van-ellipsis"]},[i.file?i.file.name:i.url]),b()])};return()=>t("div",{class:c("preview")},[S(),s(),w()])}});const He={name:H(""),accept:U("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:H(1/0),imageFit:U("cover"),resultType:U("dataUrl"),uploadIcon:U("photograph"),uploadText:String,deletable:y,reupload:Boolean,afterRead:Function,showUpload:y,modelValue:q(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:y,previewOptions:Object,previewFullImage:y,maxSize:{type:[Number,String,Function],default:1/0}};var Me=j({name:je,props:He,emits:["delete","oversize","clickUpload","closePreview","clickPreview","clickReupload","update:modelValue"],setup(e,{emit:n,slots:o}){const s=L(),m=[],p=L(-1),I=L(!1),w=(a=e.modelValue.length)=>({name:e.name,index:a}),b=()=>{s.value&&(s.value.value="")},S=a=>{if(b(),te(a,e.maxSize))if(Array.isArray(a)){const r=Ne(a,e.maxSize);if(a=r.valid,n("oversize",r.invalid,w()),!a.length)return}else{n("oversize",a,w());return}if(a=Pe(a),p.value>-1){const r=[...e.modelValue];r.splice(p.value,1,a),n("update:modelValue",r),p.value=-1}else n("update:modelValue",[...e.modelValue,...Q(a)]);e.afterRead&&e.afterRead(a,w())},i=a=>{const{maxCount:r,modelValue:v,resultType:u}=e;if(Array.isArray(a)){const C=+r-v.length;a.length>C&&(a=a.slice(0,C)),Promise.all(a.map(k=>K(k,u))).then(k=>{const se=a.map((E,_)=>{const $={file:E,status:"",message:"",objectUrl:URL.createObjectURL(E)};return k[_]&&($.content=k[_]),$});S(se)})}else K(a,u).then(C=>{const k={file:a,status:"",message:"",objectUrl:URL.createObjectURL(a)};C&&(k.content=C),S(k)})},l=a=>{const{files:r}=a.target;if(e.disabled||!r||!r.length)return;const v=r.length===1?r[0]:[].slice.call(r);if(e.beforeRead){const u=e.beforeRead(v,w());if(!u){b();return}if(Ce(u)){u.then(C=>{i(C||v)}).catch(b);return}}i(v)};let d;const f=()=>n("closePreview"),h=a=>{if(e.previewFullImage){const r=e.modelValue.filter(le),v=r.map(u=>(u.objectUrl&&!u.url&&u.status!=="failed"&&(u.url=u.objectUrl,m.push(u.url)),u.url)).filter(Boolean);d=Ve(P({images:v,startPosition:r.indexOf(a),onClose:f},e.previewOptions))}},B=()=>{d&&d.close()},O=(a,r)=>{const v=e.modelValue.slice(0);v.splice(r,1),n("update:modelValue",v),n("delete",a,w(r))},D=a=>{I.value=!0,p.value=a,ee(()=>N())},z=()=>{I.value||(p.value=-1),I.value=!1},oe=(a,r)=>{const v=["imageFit","deletable","reupload","previewSize","beforeDelete"],u=P(x(e,v),x(a,v,!0));return t($e,R({item:a,index:r,onClick:()=>n(e.reupload?"clickReupload":"clickPreview",a,w(r)),onDelete:()=>O(a,r),onPreview:()=>h(a),onReupload:()=>D(r)},x(e,["name","lazyLoad"]),u),x(o,["preview-cover","preview-delete"]))},re=()=>{if(e.previewImage)return e.modelValue.map(oe)},T=a=>n("clickUpload",a),ie=()=>{if(e.modelValue.length>=+e.maxCount&&!e.reupload)return;const a=e.modelValue.length>=+e.maxCount&&e.reupload,r=e.readonly?null:t("input",{ref:s,type:"file",class:c("input"),accept:e.accept,capture:e.capture,multiple:e.multiple&&p.value===-1,disabled:e.disabled,onChange:l,onClick:z},null);return o.default?M(t("div",{class:c("input-wrapper"),onClick:T},[o.default(),r]),[[G,!a]]):M(t("div",{class:c("upload",{readonly:e.readonly}),style:Y(e.previewSize),onClick:T},[t(A,{name:e.uploadIcon,class:c("upload-icon")},null),e.uploadText&&t("span",{class:c("upload-text")},[e.uploadText]),r]),[[G,e.showUpload&&!a]])},N=()=>{s.value&&!e.disabled&&s.value.click()};return ye(()=>{m.forEach(a=>URL.revokeObjectURL(a))}),be({chooseFile:N,closeImagePreview:B}),he(()=>e.modelValue),()=>t("div",{class:c()},[t("div",{class:c("wrapper",{disabled:e.disabled})},[re(),ie()])])}});const ea=X(Me);export{Qe as A,ea as U,Ye as s};
